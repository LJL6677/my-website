<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>é«˜æ–¯æŠ•å½±æ•™å­¦æ¼”ç¤ºç³»ç»Ÿ (ç§»åŠ¨ç«¯é€‚é…ç‰ˆ)</title>
    <style>
        :root {
            --primary: #2c3e50;
            --accent: #2980b9;
            --highlight: #c0392b;
            --yellow-line: #f1c40f;
            --bg: #f4f6f9;
            --text: #333;
            --nav-height: 60px; /* åº•éƒ¨å¯¼èˆªé«˜åº¦ */
        }

        body { margin: 0; font-family: "Microsoft YaHei", "Segoe UI", sans-serif; background: var(--bg); display: flex; height: 100vh; overflow: hidden; color: var(--text); }

        /* --- å¸ƒå±€ç³»ç»Ÿ --- */
        /* é»˜è®¤æ¡Œé¢ç«¯å¸ƒå±€ */
        .sidebar { width: 240px; background: var(--primary); color: #fff; padding: 20px; display: flex; flex-direction: column; z-index: 100; box-shadow: 2px 0 10px rgba(0,0,0,0.1); }
        .main { flex: 1; display: flex; flex-direction: column; overflow: hidden; position: relative; }
        
        .logo { font-size: 1.1rem; font-weight: bold; border-bottom: 1px solid rgba(255,255,255,0.2); padding-bottom: 15px; margin-bottom: 20px; }
        .nav-btn { background: transparent; border: none; color: rgba(255,255,255,0.7); text-align: left; padding: 12px; cursor: pointer; border-radius: 4px; margin-bottom: 5px; font-size: 0.95rem; transition: 0.3s; }
        .nav-btn:hover { background: rgba(255,255,255,0.1); color: #fff; }
        .nav-btn.active { background: var(--accent); color: #fff; font-weight: bold; border-left: 4px solid #fff; }

        /* é¢æ¿æ§åˆ¶ */
        .panel { display: none; height: 100%; flex-direction: column; animation: fadeIn 0.3s; overflow-y: hidden; }
        .panel.active { display: flex; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* å¤´éƒ¨ä¿¡æ¯ */
        .header { 
            background: #fff; padding: 15px 20px; border-bottom: 1px solid #ddd; 
            font-weight: bold; color: var(--primary); font-size: 1.1rem;
            display: flex; justify-content: space-between; align-items: center;
            flex-shrink: 0;
        }
        .course-info { font-size: 0.85rem; color: #666; font-weight: normal; display: flex; flex-direction: column; align-items: flex-start; }
        .course-info span { background: #f0f0f0; padding: 3px 8px; border-radius: 3px; margin-left: 5px; }
        .competition-info { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 5px 12px; border-radius: 20px; font-size: 0.8rem; font-weight: bold; margin-bottom: 5px; }

        /* é€šç”¨æŒ‰é’® */
        .btn { padding: 10px 15px; border: none; border-radius: 4px; cursor: pointer; font-size: 0.9rem; transition: 0.2s; color: #fff; background: var(--primary); margin-right: 5px; margin-bottom: 5px; }
        .btn:active { opacity: 0.7; transform: scale(0.98); }
        .btn-outline { background: #fff; border: 1px solid var(--accent); color: var(--accent); width: 100%; text-align: left; margin-bottom: 8px; padding: 10px; }
        
        /* --- åŠŸèƒ½1ï¼šæŠ•å½±å˜å½¢ --- */
        .split-container { display: flex; flex: 1; overflow: hidden; height: 100%; }
        .canvas-box { flex: 1; position: relative; background: #fff; cursor: crosshair; overflow: hidden; }
        canvas { display: block; width: 100%; height: 100%; touch-action: none; /* ç¦æ­¢è§¦æ‘¸æ»šåŠ¨ */ }
        
        .side-panel { width: 340px; background: #fdfdfd; border-left: 1px solid #ddd; padding: 20px; overflow-y: auto; display: flex; flex-direction: column; -webkit-overflow-scrolling: touch; }
        .conclusion-box { display: none; padding: 15px; background: #e8f8f5; border-left: 5px solid #1abc9c; margin-bottom: 15px; font-size: 0.9rem; line-height: 1.6; border-radius: 4px; }

        /* --- åŠŸèƒ½2ï¼šåˆ†å¸¦è®¡ç®— --- */
        .calc-container { padding: 20px; flex: 1; display: flex; flex-direction: column; overflow-y: auto; -webkit-overflow-scrolling: touch; }
        .input-area { background: #fff; padding: 15px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); display: flex; align-items: center; gap: 10px; margin-bottom: 15px; flex-wrap: wrap; }
        .input-area input { padding: 10px; border: 1px solid #ccc; border-radius: 4px; width: 100px; font-size: 16px; /* é˜²æ­¢iOSç¼©æ”¾ */ }
        
        .control-buttons { display: flex; gap: 8px; margin-top: 5px; width: 100%; flex-wrap: wrap; }
        .zone-btn { background: #f0f0f0; border: 1px solid #ccc; padding: 8px 12px; border-radius: 4px; cursor: pointer; font-size: 0.85rem; color: #333; flex: 1; text-align: center; }
        .zone-btn.active { background: var(--accent); color: white; border-color: var(--accent); }
        
        .track-display { 
            position: relative; height: 450px; background: #fff; border: 1px solid #ccc; 
            border-radius: 8px; overflow: auto; margin-bottom: 20px; min-height: 350px; 
            /* è§¦æ‘¸ä¼˜åŒ– */
            touch-action: pan-x pan-y; 
            -webkit-overflow-scrolling: touch;
        }
        .track-lane { position: absolute; height: 80px; width: 100%; }
        .zone-block { 
            position: absolute; height: 60px; border: 1px solid #bbb; background: #f9f9f9; 
            display: flex; flex-direction: column; align-items: center; justify-content: center; 
            font-size: 12px; box-sizing: border-box; cursor: pointer;
        }
        .zone-block.active { background: #d6eaf8; border: 2px solid var(--accent); z-index: 10; font-weight: bold; }
        
        .center-line-dashed { position: absolute; left: 50%; top: 0; bottom: 0; width: 0; border-left: 2px dashed var(--yellow-line); z-index: 50; }
        .center-label { position: absolute; left: 50%; top: 5px; transform: translateX(-50%); background: var(--yellow-line); color: #000; padding: 2px 6px; border-radius: 4px; font-size: 10px; font-weight: bold; z-index: 51; }
        .division-line-6 { position: absolute; top: 0; bottom: 0; width: 0; border-left: 1px dashed #e74c3c; z-index: 40; opacity: 0.6; }
        .division-line-3 { position: absolute; top: 185px; bottom: 0; width: 0; border-left: 1px dashed #27ae60; z-index: 40; opacity: 0.6; }
        .division-label { position: absolute; font-size: 9px; color: #fff; padding: 1px 3px; border-radius: 2px; z-index: 41; transform: translateX(-50%); white-space: nowrap; }

        .formula-container { background: #fff; padding: 15px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); margin-bottom: 15px; }
        .formula-panel { display: none; background: #fff8e1; padding: 15px; border: 1px solid #ffe082; border-radius: 8px; margin-top: 10px; overflow-x: auto; }
        .formula-row { display: flex; margin-bottom: 10px; align-items: center; min-width: 300px; }
        .formula-label { width: 140px; font-weight: bold; color: #333; font-size: 0.9rem; }
        .formula-equation { flex: 1; font-family: "Cambria Math", serif; font-size: 1rem; color: #c0392b; }
        .formula-result { width: 80px; text-align: center; font-weight: bold; color: var(--accent); }
        .theory-box { background: #f9f9f9; padding: 15px; border-radius: 8px; border-left: 5px solid #9b59b6; margin-bottom: 20px; font-size: 0.9rem; line-height: 1.6; }

        /* --- åŠŸèƒ½3ï¼šåæ ‡å¹³ç§» --- */
        .coord-layout { padding: 15px; flex: 1; display: flex; flex-direction: column; overflow-y: auto; -webkit-overflow-scrolling: touch; }
        .coord-top-section { display: flex; gap: 20px; margin-bottom: 20px; flex-wrap: wrap; }
        .coord-controls { flex: 1; min-width: 250px; background: #fff; padding: 15px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); display: flex; flex-direction: column; }
        .step-buttons { display: flex; flex-direction: column; gap: 8px; margin-bottom: 15px; }
        .step-info { background: #f8f9fa; padding: 12px; border-radius: 6px; border-left: 4px solid var(--accent); font-size: 0.85rem; line-height: 1.5; }
        
        .anim-stage-container { flex: 2; min-width: 300px; background: #fff; padding: 15px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); display: flex; flex-direction: column; }
        .anim-stage { flex: 1; min-height: 250px; background: #fff; border: 1px solid #ccc; border-radius: 4px; position: relative; overflow: hidden; margin-bottom: 15px; }
        
        .axis-y { position: absolute; left: 0; right: 0; height: 1px; background: #999; bottom: 40px; }
        .axis-x { position: absolute; top: 0; bottom: 0; width: 2px; background: var(--highlight); left: 50%; transition: left 1.2s ease-in-out; z-index: 5; }
        .point-dot { position: absolute; width: 14px; height: 14px; border-radius: 50%; transform: translate(-50%, 50%); z-index: 10; transition: all 1.2s ease-in-out; border: 2px solid #fff; box-shadow: 0 2px 4px rgba(0,0,0,0.2); }
        .point-label { position: absolute; font-size: 12px; font-weight: bold; background: rgba(255,255,255,0.95); padding: 2px 6px; border-radius: 4px; transform: translate(-50%, -120%); z-index: 11; transition: all 1.2s ease-in-out; box-shadow: 0 2px 4px rgba(0,0,0,0.1); white-space: nowrap; min-width: 60px; text-align: center; }
        
        .axis-label { position: absolute; top: 10px; left: 10px; color: var(--highlight); font-weight: bold; font-size: 12px; background: rgba(255,255,255,0.9); padding: 2px 5px; border-radius: 3px; }
        .scale-label { position: absolute; bottom: 10px; color: #999; font-size: 11px; }
        .scale-west { left: 10px; }
        .scale-east { right: 10px; }

        /* è¡¨æ ¼å“åº”å¼å¤„ç† */
        .table-wrapper { width: 100%; overflow-x: auto; margin-bottom: 15px; border-radius: 6px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        table.full-table { width: 100%; min-width: 500px; border-collapse: collapse; background: #fff; }
        table.full-table th, table.full-table td { border: 1px solid #ddd; padding: 10px; text-align: center; font-size: 0.9rem; }
        table.full-table th { background: #f2f2f2; font-weight: bold; color: var(--primary); }
        .coord-value { font-weight: bold; font-size: 1em; }
        
        .conclusion-footer { display: block; padding: 15px; background: #eef2f5; border-left: 5px solid var(--primary); font-size: 0.9rem; line-height: 1.6; color: var(--primary); border-radius: 4px; margin-top: 15px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .conclusion-title { font-size: 0.95rem; font-weight: bold; color: var(--primary); margin-bottom: 10px; display: flex; align-items: center; }
        .conclusion-title:before { content: "â–¶"; margin-right: 8px; font-size: 0.8rem; }

        /* ================= ç§»åŠ¨ç«¯é€‚é… (Media Queries) ================= */
        @media (max-width: 768px) {
            body { flex-direction: column; }
            
            /* ä¾§è¾¹æ å˜ä¸ºåº•éƒ¨å¯¼èˆª */
            .sidebar { 
                width: 100%; height: var(--nav-height); 
                position: fixed; bottom: 0; left: 0; 
                flex-direction: row; padding: 0; 
                justify-content: space-around; align-items: center;
                box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
                order: 2; /* æ”¾åˆ°ä¸‹é¢ */
            }
            
            .logo { display: none; } /* æ‰‹æœºä¸Šéšè—ä¾§è¾¹æ Logoä»¥èŠ‚çœç©ºé—´ */
            
            .nav-btn { 
                margin: 0; padding: 0; text-align: center; 
                border-radius: 0; flex: 1; height: 100%;
                display: flex; flex-direction: column; justify-content: center; align-items: center;
                font-size: 0.8rem; line-height: 1.2;
                border-left: none; /* å»æ‰å·¦è¾¹æ¡† */
                border-top: 4px solid transparent;
            }
            .nav-btn.active { border-left: none; border-top: 4px solid var(--accent); background: rgba(0,0,0,0.2); }
            
            .main { margin-bottom: var(--nav-height); order: 1; width: 100%; }
            
            /* å¤´éƒ¨ç²¾ç®€ */
            .header { padding: 10px; font-size: 1rem; flex-direction: column; align-items: flex-start; }
            .course-info { display: none; } /* æ‰‹æœºç«¯éšè—è¯¦ç»†è¯¾ç¨‹ä¿¡æ¯ */
            .mobile-header-text { display: block; font-size: 0.9rem; color: #666; margin-top: 4px; }
            
            /* åŠŸèƒ½1ï¼šæŠ•å½±å˜å½¢ å¸ƒå±€è°ƒæ•´ */
            .split-container { flex-direction: column; overflow-y: auto; }
            .canvas-box { min-height: 45vh; flex: none; border-bottom: 1px solid #ddd; }
            .side-panel { width: 100%; height: auto; border-left: none; flex: 1; padding: 15px; }
            
            /* åŠŸèƒ½2ï¼šåˆ†å¸¦è®¡ç®— å¸ƒå±€è°ƒæ•´ */
            .calc-container { padding: 10px; }
            .input-area { padding: 10px; flex-direction: column; align-items: stretch; }
            .input-area input { width: 100%; box-sizing: border-box; }
            .track-display { height: 350px; min-height: 300px; }
            
            /* åŠŸèƒ½3ï¼šåæ ‡å¹³ç§» å¸ƒå±€è°ƒæ•´ */
            .coord-layout { padding: 10px; }
            .coord-top-section { flex-direction: column; gap: 15px; }
            .coord-controls { min-width: auto; padding: 12px; }
            .anim-stage-container { min-width: auto; flex: none; height: 300px; padding: 10px; }
            
            /* è¡¨æ ¼å­—ä½“ç¼©å° */
            table.full-table th, table.full-table td { padding: 6px; font-size: 0.8rem; }
            
            /* æç¤ºæ–‡å­— */
            .mobile-hint { display: block; color: var(--accent); font-size: 0.8rem; text-align: center; margin-top: 5px; }
        }
        
        .mobile-header-text { display: none; }
        .mobile-hint { display: none; }

    </style>
</head>
<body>

<!-- ä¾§è¾¹æ  / åº•éƒ¨å¯¼èˆª -->
<div class="sidebar">
    <div class="logo">é«˜æ–¯æŠ•å½±æ•™å­¦ç³»ç»Ÿ</div>
    <button class="nav-btn active" onclick="switchPanel(0)">
        <span style="font-size:1.2em; display:block; margin-bottom:2px;">ğŸŒ</span>
        1.å˜å½¢è§„å¾‹
    </button>
    <button class="nav-btn" onclick="switchPanel(1)">
        <span style="font-size:1.2em; display:block; margin-bottom:2px;">ğŸ“</span>
        2.åˆ†å¸¦è®¡ç®—
    </button>
    <button class="nav-btn" onclick="switchPanel(2)">
        <span style="font-size:1.2em; display:block; margin-bottom:2px;">â†”ï¸</span>
        3.åæ ‡å¹³ç§»
    </button>
</div>

<div class="main">

    <!-- é¢æ¿1ï¼šæŠ•å½±å˜å½¢ -->
    <div id="panel-1" class="panel active">
        <div class="header">
            <div>
                <div>é«˜æ–¯æŠ•å½±ï¼šå˜å½¢è§„å¾‹ä¸ç­‰è§’æ€§</div>
                <div class="mobile-header-text">ç¬¬äºŒç«  ç¬¬ä¸‰èŠ‚ é«˜æ–¯-å…‹å•æ ¼æŠ•å½±</div>
            </div>
            <div class="course-info">
                <div>æˆè¯¾æ•™å¸ˆï¼šåˆ˜ä½³ä¸½ | è¯¾ç¨‹ï¼šæµ‹é‡ä¸åœ°å›¾å­¦</div>
            </div>
        </div>
        <div class="split-container">
            <!-- ç”»å¸ƒ -->
            <div class="canvas-box" id="canvas-container">
                <canvas id="projCanvas"></canvas>
                <div style="position:absolute; bottom:10px; left:10px; font-size:11px; color:#666; background:rgba(255,255,255,0.8); padding:5px; border-radius:4px; pointer-events:none;">
                    * çº¢è‰²çº¿ä¸ºä¸­å¤®ç»çº¿ | æ‰‹æŒ‡/é¼ æ ‡æ»‘åŠ¨æŸ¥çœ‹å˜å½¢
                </div>
                <div class="mobile-hint" style="position:absolute; top:10px; right:10px; background:rgba(255,255,255,0.8); padding:2px 5px; border-radius:4px;">â˜ï¸ åœ¨ç”»å¸ƒä¸Šæ»‘åŠ¨æ‰‹æŒ‡</div>
            </div>

            <!-- å³ä¾§/åº•éƒ¨æ§åˆ¶ -->
            <div class="side-panel">
                <div style="margin-bottom:20px; padding:10px; background:#f0f0f0; border-radius:4px;">
                    <strong>å®æ—¶å‚æ•°ï¼š</strong>
                    <div style="display:flex; justify-content:space-between; margin-top:5px;">
                        <span>çº¬åº¦(B): <span id="val-lat">0</span>Â°</span>
                        <span>ç»å·®(l): <span id="val-l">0</span>Â°</span>
                    </div>
                    <div style="font-size:1.1em; color:red; font-weight:bold; margin-top:8px; border-top:1px solid #ccc; padding-top:5px;">
                        å˜å½¢ç³»æ•° k â‰ˆ <span id="val-k">1.000</span>
                    </div>
                </div>

                <strong style="display:block; margin-bottom:10px;">è¯¾å ‚äº’åŠ¨ç»“è®ºï¼š</strong>
                
                <button class="btn btn-outline" onclick="toggleDisplay('conc-1')">â–¶ ç‚¹å‡»æ˜¾ç¤ºï¼šç­‰è§’æŠ•å½±è§„å¾‹</button>
                <div id="conc-1" class="conclusion-box">
                    <strong>1. å½¢çŠ¶ä¸å˜ (ç­‰è§’æ€§)ï¼š</strong><br>
                    æ©™è‰²çš„å˜å½¢æ¤­åœ†åœ¨å±€éƒ¨å§‹ç»ˆä¿æŒ<strong>æ­£åœ†å½¢</strong>ï¼Œè¯´æ˜è§’åº¦ä¸å˜ã€‚<br>
                    <strong>2. é¢ç§¯å¿…ç„¶å˜å½¢ï¼š</strong><br>
                    åœ†çš„å¤§å°ï¼ˆé¢ç§¯ï¼‰åœ¨ä¸åŒä½ç½®å·®å¼‚å·¨å¤§ã€‚<br>
                </div>

                <button class="btn btn-outline" onclick="toggleDisplay('conc-2')">â–¶ ç‚¹å‡»æ˜¾ç¤ºï¼šå˜å½¢åˆ†å¸ƒè§„å¾‹</button>
                <div id="conc-2" class="conclusion-box">
                    <strong>1. ä¸­å¤®ç»çº¿æ— å˜å½¢ï¼š</strong><br>
                    åœ¨ä¸­å¤®ç»çº¿ï¼ˆçº¢çº¿ï¼‰ä¸Šï¼Œk=1ã€‚<br><br>
                    <strong>2. éšä½ç½®å˜åŒ–è§„å¾‹ï¼š</strong><br>
                    ç¦»çº¢çº¿è¶Šè¿œï¼Œå˜å½¢è¶Šå¤§ï¼›<br>
                    çº¬åº¦è¶Šä½ï¼ˆè¿‘èµ¤é“ï¼‰ï¼Œå˜å½¢è¶Šå¤§ã€‚<br>
                    â˜… <strong>æœ€å¤§å˜å½¢</strong>å‘ç”Ÿåœ¨<strong>èµ¤é“è¾¹ç¼˜</strong>å¤„ã€‚
                </div>
            </div>
        </div>
    </div>

    <!-- é¢æ¿2ï¼šåˆ†å¸¦è®¡ç®— -->
    <div id="panel-2" class="panel">
        <div class="header">
            <div>
                <div>åˆ†å¸¦è®¡ç®—ï¼š6åº¦å¸¦ä¸3åº¦å¸¦å¯¹é½</div>
                <div class="mobile-header-text">ç‚¹å‡»å¸¦å·å¯è‡ªåŠ¨å±…ä¸­</div>
            </div>
        </div>
        <div class="calc-container">
            <!-- è®¡ç®—å…¬å¼ä¸ç»“æœ -->
            <div class="formula-container">
                <div style="text-align:center;">
                    <button class="btn" style="background:var(--highlight); width:100%;" onclick="toggleDisplay('formula-area')">ğŸ“‹ ç‚¹å‡»æŸ¥çœ‹è®¡ç®—å…¬å¼</button>
                </div>

                <div id="formula-area" class="formula-panel">
                    <div style="margin-bottom:15px;">
                        <h3 style="margin-top:0; color:var(--primary); font-size:1rem;">è®¡ç®—å…¬å¼ (ä¸œç» L):</h3>
                        
                        <div class="formula-row">
                            <div class="formula-label">6åº¦å¸¦å¸¦å·:</div>
                            <div class="formula-equation">N = Int(L / 6) + 1</div>
                            <div class="formula-result" id="calc-n6">-</div>
                        </div>
                        <div class="formula-row">
                            <div class="formula-label">3åº¦å¸¦å¸¦å·:</div>
                            <div class="formula-equation">n = Int((L - 1.5) / 3) + 1</div>
                            <div class="formula-result" id="calc-n3">-</div>
                        </div>
                        <div style="font-size:0.8rem; color:#666; margin-top:5px;">* ä¸­å¤®ç»çº¿å…¬å¼è¯·è§æ•™æ</div>
                    </div>
                </div>
            </div>

            <div class="input-area">
                <div style="flex:1; display:flex; align-items:center;">
                    <strong style="white-space:nowrap; margin-right:5px;">ç»åº¦:</strong>
                    <input type="number" id="input-lon" value="116.4" step="0.1" placeholder="å¦‚ 116.4" inputmode="decimal">
                    <span style="margin: 0 10px;">Â°E</span>
                </div>
                <button class="btn" onclick="jumpToZone()" style="width:100%;">è·³è½¬å¹¶å±…ä¸­</button>
                
                <div class="control-buttons">
                    <button class="zone-btn active" id="btn-show-6" onclick="toggleDivisionLines(6)">6Â°å¸¦çº¿</button>
                    <button class="zone-btn active" id="btn-show-3" onclick="toggleDivisionLines(3)">3Â°å¸¦çº¿</button>
                </div>
            </div>

            <!-- è½¨é“è§†å›¾ -->
            <div class="track-display">
                <!-- ä¸­å¤®åŸºå‡† -->
                <div class="center-line-dashed"></div>
                <div class="center-label">å½“å‰ä½ç½®</div>

                <div style="position:absolute; top:10px; left:10px; font-weight:bold; color:#e74c3c;">6åº¦å¸¦</div>
                <div id="track-6" class="track-lane" style="top:35px;"></div>

                <div style="position:absolute; top:160px; left:10px; font-weight:bold; color:#27ae60;">3åº¦å¸¦</div>
                <div id="track-3" class="track-lane" style="top:185px;"></div>
                
                <div id="division-lines-container"></div>
            </div>
            
            <div class="theory-box">
                <strong>ğŸ’¡ çŸ¥è¯†ç‚¹ï¼š</strong><br>
                å¯¹é½ç›®çš„ï¼šä½¿6Â°å¸¦çš„ä¸­å¤®ç»çº¿å…¨éƒ¨ä¸º3Â°å¸¦çš„ä¸­å¤®ç»çº¿ï¼Œä»¥ä¾¿åœ¨ç”±3Â°å¸¦è½¬æ¢æˆ6Â°å¸¦æ—¶ï¼Œä¸éœ€ä»»ä½•è®¡ç®—ï¼Œè€Œç›´æ¥è½¬ç”¨ã€‚
            </div>
        </div>
    </div>

    <!-- é¢æ¿3ï¼šåæ ‡å¹³ç§» -->
    <div id="panel-3" class="panel">
        <div class="header">
            <div>
                <div>åæ ‡å¹³ç§» (Yå€¼è½¬æ­£æ¼”ç¤º)</div>
                <div class="mobile-header-text">é€šç”¨åæ ‡ Y = å¸¦å· + (Y' + 500km)</div>
            </div>
        </div>
        <div class="coord-layout">
            <!-- é¡¶éƒ¨åŒºåŸŸï¼šæ§åˆ¶æŒ‰é’®å’ŒåŠ¨ç”»åŒºåŸŸ -->
            <div class="coord-top-section">
                <!-- åŠ¨ç”»æ¼”ç¤ºåŒºåŸŸ (æ‰‹æœºç«¯ä¼˜å…ˆå±•ç¤º) -->
                <div class="anim-stage-container">
                    <div class="anim-stage">
                        <!-- è½´ -->
                        <div class="axis-y">
                            <div style="position:absolute; right:10px; bottom:5px; color:#666; font-size:12px;">èµ¤é“ (Xè½´)</div>
                        </div>
                        <div id="anim-axis-x" class="axis-x">
                            <div style="position:absolute; top:10px; left:5px; color:var(--highlight); font-weight:bold; white-space:nowrap;">
                                ä¸­å¤®ç»çº¿<br><span id="axis-label" style="background:#fff;">Y=0</span>
                            </div>
                        </div>
                        
                        <!-- æ ‡å°º -->
                        <div class="scale-label scale-west">è¥¿ (-Y)</div>
                        <div class="scale-label scale-east">ä¸œ (+Y)</div>

                        <!-- ç‚¹A -->
                        <div id="pt-a" class="point-dot" style="background:#27ae60; left:65%; bottom:70%;"></div>
                        <div id="lbl-a" class="point-label" style="left:65%; bottom:70%; color:#27ae60;">A</div>

                        <!-- ç‚¹B -->
                        <div id="pt-b" class="point-dot" style="background:#8e44ad; left:35%; bottom:60%;"></div>
                        <div id="lbl-b" class="point-label" style="left:35%; bottom:60%; color:#8e44ad;">B</div>
                        
                        <!-- è½´æ ‡ç­¾ -->
                        <div class="axis-label">Yè½´ (æ¨ªåæ ‡)</div>
                    </div>
                </div>

                <!-- æ§åˆ¶æŒ‰é’® -->
                <div class="coord-controls">
                    <div class="step-buttons">
                        <button class="btn" onclick="setStep(0)" style="background:#27ae60;">1. åŸå§‹å€¼</button>
                        <button class="btn" onclick="setStep(1)" style="background:#2980b9;">2. è¥¿ç§» (+500km)</button>
                        <button class="btn" onclick="setStep(2)" style="background:#9b59b6;">3. é€šç”¨åæ ‡</button>
                        <button class="btn" style="background:#7f8c8d;" onclick="setStep(-1)">é‡ç½®</button>
                    </div>
                    <div class="step-info">
                        <strong>è¯´æ˜ï¼š</strong>
                        å¹³ç§»æ˜¯ä¸ºäº†é¿å…Yå‡ºç°è´Ÿå€¼ã€‚å°†ä¸­å¤®ç»çº¿è¥¿ç§»500km (Y+500,000)ã€‚
                    </div>
                </div>
            </div>
            
            <!-- ä¸­éƒ¨ï¼šåæ ‡è¡¨æ ¼ -->
            <div style="margin-bottom:15px;">
                <h3 style="margin-top:0; margin-bottom:10px; color:var(--primary); font-size:1rem;">åæ ‡å˜æ¢è¡¨ (å‘å³æ»‘åŠ¨)</h3>
                <div class="table-wrapper">
                    <table class="full-table">
                        <thead>
                            <tr>
                                <th width="15%">ç‚¹</th>
                                <th width="25%">1. åŸå§‹ Y</th>
                                <th width="30%">2. å¹³ç§»å Y'</th>
                                <th width="30%">3. é€šç”¨åæ ‡ Y</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>A</strong></td>
                                <td style="color:#27ae60" class="coord-value">152,863</td>
                                <td id="td-shift-a" class="coord-value">-</td>
                                <td id="td-gen-a" class="coord-value" style="color:var(--primary)">-</td>
                            </tr>
                            <tr>
                                <td><strong>B</strong></td>
                                <td style="color:red" class="coord-value">-148,474</td>
                                <td id="td-shift-b" class="coord-value">-</td>
                                <td id="td-gen-b" class="coord-value" style="color:var(--primary)">-</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- åº•éƒ¨ï¼šç»“è®º -->
            <div class="conclusion-footer">
                <div class="conclusion-title">é€šç”¨æ¨ªåæ ‡å…¬å¼</div>
                Y<sub>é€šç”¨</sub> = å¸¦å·(Y<sub>å®é™…</sub> + 500,000)
            </div>
        </div>
    </div>

</div>

<script>
    // --- å¯¼èˆª ---
    function switchPanel(idx) {
        document.querySelectorAll('.panel').forEach((p, i) => p.classList.toggle('active', i===idx));
        document.querySelectorAll('.nav-btn').forEach((b, i) => b.classList.toggle('active', i===idx));
        if(idx === 0) setTimeout(initCanvas, 100);
        if(idx === 1) setTimeout(() => {
            jumpToZone();
            updateCalculations();
        }, 100);
    }
    function toggleDisplay(id) {
        const el = document.getElementById(id);
        el.style.display = (el.style.display === 'block') ? 'none' : 'block';
    }

    // ================= åŠŸèƒ½1ï¼šæŠ•å½±å˜å½¢ (æ›²çº¿ä¿®æ­£ç‰ˆ) =================
    const canvas = document.getElementById('projCanvas');
    const ctx = canvas.getContext('2d');
    let cw, ch;

    function initCanvas() {
        const box = document.getElementById('canvas-container');
        cw = box.clientWidth;
        ch = box.clientHeight;
        canvas.width = cw;
        canvas.height = ch;
        drawGrid();
    }

    function project(lat, lonDiff) {
        // è°ƒæ•´æ¯”ä¾‹å°ºé€‚é…æ‰‹æœºå±å¹•
        const scale = Math.min(cw, ch) / 140; 
        const cx = cw / 2;
        const cy = ch / 2;
        
        const radLat = lat * Math.PI / 180;
        const x_pos = (lonDiff * Math.cos(radLat)) * 30; 
        const curveFactor = Math.pow(lonDiff, 2) * Math.sin(radLat) * Math.cos(radLat) * 0.5;
        const y_pos = lat + curveFactor * 10; 
        
        const x_scr = cx + x_pos * scale;
        const y_scr = cy - y_pos * scale;
        return {x: x_scr, y: y_scr};
    }

    function calculateDistortion(lat, lonDiff) {
        const rad = lat * Math.PI / 180;
        const latFactor = Math.pow(Math.cos(rad), 2);
        const lonFactor = Math.pow(lonDiff, 2);
        return 1 + lonFactor * latFactor * 0.2;
    }

    function drawGrid() {
        ctx.clearRect(0,0,cw,ch);
        // ç»çº¿
        ctx.lineWidth = 1;
        for(let l=-6; l<=6; l+=2) {
            ctx.beginPath();
            ctx.strokeStyle = (l===0) ? '#c0392b' : '#ddd';
            ctx.lineWidth = (l===0) ? 2 : 1;
            for(let p=-85; p<=85; p+=1) {
                const pt = project(p, l);
                if(p===-85) ctx.moveTo(pt.x, pt.y); else ctx.lineTo(pt.x, pt.y);
            }
            ctx.stroke();
        }
        // çº¬çº¿
        ctx.strokeStyle = '#eee';
        ctx.lineWidth = 1;
        for(let p=-80; p<=80; p+=10) {
            ctx.beginPath();
            if(p===0) ctx.strokeStyle = '#2980b9'; 
            for(let l=-6; l<=6; l+=0.1) {
                const pt = project(p, l);
                if(l===-6) ctx.moveTo(pt.x, pt.y); else ctx.lineTo(pt.x, pt.y);
            }
            ctx.stroke();
            if(p===0) ctx.strokeStyle = '#eee';
        }
        // æ¤­åœ†
        ctx.fillStyle = "rgba(230, 126, 34, 0.5)";
        ctx.strokeStyle = "#d35400";
        for(let l=-4; l<=4; l+=2) {
            for(let p=-60; p<=60; p+=15) {
                const pt = project(p, l);
                const k = calculateDistortion(p, l);
                const radius = (Math.min(cw,ch)/180) * 5 * k;
                
                ctx.beginPath();
                ctx.arc(pt.x, pt.y, radius, 0, Math.PI*2);
                ctx.fill();
                ctx.stroke();
                
                if(Math.abs(p) < 5) {
                    ctx.fillStyle = "rgba(231, 76, 60, 0.3)";
                    ctx.beginPath();
                    ctx.arc(pt.x, pt.y, radius, 0, Math.PI*2);
                    ctx.fill();
                    ctx.fillStyle = "rgba(230, 126, 34, 0.5)";
                }
            }
        }
    }

    // äº¤äº’é€»è¾‘ (é¼ æ ‡ + è§¦æ‘¸)
    function handleInteraction(clientX, clientY) {
        const r = canvas.getBoundingClientRect();
        const scale = Math.min(cw, ch) / 140;
        const cy = ch / 2;
        const lat = -(clientY - r.top - cy) / scale;
        
        const rad = lat * Math.PI / 180;
        let cos = Math.cos(rad);
        if(Math.abs(cos) < 0.1) cos=0.1;
        const cx = cw / 2;
        const mx = clientX - r.left;
        const l = (mx - cx) / (scale * 30 * cos);

        const k = calculateDistortion(lat, l);

        document.getElementById('val-k').innerText = k.toFixed(3);
        document.getElementById('val-l').innerText = Math.abs(l).toFixed(1);
        document.getElementById('val-lat').innerText = lat.toFixed(0);
    }

    canvas.addEventListener('mousemove', (e) => handleInteraction(e.clientX, e.clientY));
    
    // æ·»åŠ è§¦æ‘¸æ”¯æŒ
    canvas.addEventListener('touchstart', (e) => {
        if(e.touches.length > 0) handleInteraction(e.touches[0].clientX, e.touches[0].clientY);
    }, {passive: true});

    canvas.addEventListener('touchmove', (e) => {
        if(e.touches.length > 0) {
            // é˜²æ­¢é¡µé¢æ»šåŠ¨ï¼Œæå‡ä½“éªŒ
            // e.preventDefault(); 
            handleInteraction(e.touches[0].clientX, e.touches[0].clientY);
        }
    }, {passive: false});
    
    window.addEventListener('resize', () => { 
        if(document.querySelector('#panel-1').classList.contains('active')) initCanvas(); 
    });

    // ================= åŠŸèƒ½2ï¼šåˆ†å¸¦è®¡ç®— =================
    const pxPerDeg = 28; 
    let show6Divisions = true;
    let show3Divisions = true;

    function toggleDivisionLines(type) {
        if (type === 6) {
            show6Divisions = !show6Divisions;
            document.getElementById('btn-show-6').classList.toggle('active', show6Divisions);
        } else {
            show3Divisions = !show3Divisions;
            document.getElementById('btn-show-3').classList.toggle('active', show3Divisions);
        }
        drawDivisionLines();
    }

    function drawDivisionLines() {
        const container = document.getElementById('division-lines-container');
        container.innerHTML = '';
        
        const trackDisplay = container.parentElement;
        const boxWidth = trackDisplay.clientWidth;
        const centerPx = boxWidth / 2;
        const lon = parseFloat(document.getElementById('input-lon').value) || 116.4;
        
        const startLon = lon - 30;
        const endLon = lon + 30;
        
        if (show6Divisions) {
            for (let n = 1; n <= 30; n++) {
                const cmLon6 = 6 * n - 3; 
                if (cmLon6 >= startLon && cmLon6 <= endLon) {
                    const leftPos = centerPx + (cmLon6 - lon) * pxPerDeg;
                    const lineDiv = document.createElement('div');
                    lineDiv.className = 'division-line-6';
                    lineDiv.style.left = leftPos + 'px';
                    container.appendChild(lineDiv);
                    
                    const labelDiv = document.createElement('div');
                    labelDiv.className = 'division-label';
                    labelDiv.style.left = leftPos + 'px';
                    labelDiv.style.top = '45px';
                    labelDiv.style.background = '#e74c3c';
                    labelDiv.innerText = `${cmLon6}Â°`;
                    container.appendChild(labelDiv);
                }
            }
        }
        
        if (show3Divisions) {
            for (let n = 1; n <= 60; n++) {
                const cmLon3 = 3 * n; 
                if (cmLon3 >= startLon && cmLon3 <= endLon) {
                    const leftPos = centerPx + (cmLon3 - lon) * pxPerDeg;
                    const lineDiv = document.createElement('div');
                    lineDiv.className = 'division-line-3';
                    lineDiv.style.left = leftPos + 'px';
                    container.appendChild(lineDiv);
                    
                    if (n % 2 === 0) {
                        const labelDiv = document.createElement('div');
                        labelDiv.className = 'division-label';
                        labelDiv.style.left = leftPos + 'px';
                        labelDiv.style.top = '210px';
                        labelDiv.style.background = '#27ae60';
                        labelDiv.innerText = `${cmLon3}Â°`;
                        container.appendChild(labelDiv);
                    }
                }
            }
        }
        
        const requiredWidth = Math.max((lon - startLon) * pxPerDeg * 2, (endLon - lon) * pxPerDeg * 2, boxWidth);
        if (requiredWidth > boxWidth) trackDisplay.style.width = requiredWidth + 'px';
    }

    function updateCalculations() {
        const lon = parseFloat(document.getElementById('input-lon').value) || 116.4;
        const n6 = Math.floor(lon/6) + 1;
        const cm6 = 6 * n6 - 3;
        const n3 = Math.floor((lon - 1.5) / 3) + 1;
        const cm3 = 3 * n3;
        
        document.getElementById('calc-n6').innerText = n6;
        document.getElementById('calc-n3').innerText = n3;
    }

    function jumpToZone() {
        const lonInput = document.getElementById('input-lon');
        let lon = parseFloat(lonInput.value);
        if(isNaN(lon)) { lon = 116.4; lonInput.value = lon; }
        if(lon < 0) lon = 0; if(lon > 180) lon = 180;
        
        updateCalculations();
        drawZones(lon);
        drawDivisionLines();
    }

    function drawZones(centerLon) {
        const track6 = document.getElementById('track-6');
        const track3 = document.getElementById('track-3');
        track6.innerHTML = '';
        track3.innerHTML = '';
        
        const trackDisplay = track6.parentElement;
        const boxWidth = trackDisplay.clientWidth;
        const centerPx = boxWidth / 2;
        const centerLabel = document.querySelector('.center-label');
        if (centerLabel) centerLabel.innerText = `å½“å‰: ${centerLon.toFixed(1)}Â°`;
        
        const startLon = centerLon - 30;
        const endLon = centerLon + 30;
        
        // 6åº¦å¸¦
        for(let i = -3; i <= 3; i++) {
            const zoneNum6 = Math.floor(centerLon/6) + 1 + i;
            if(zoneNum6 < 1 || zoneNum6 > 30) continue;
            const startLon6 = (zoneNum6 - 1) * 6;
            const endLon6 = zoneNum6 * 6;
            const cmLon6 = startLon6 + 3;
            
            if (cmLon6 >= startLon && cmLon6 <= endLon) {
                const blockWidth6 = 6 * pxPerDeg;
                const leftPos6 = centerPx + (cmLon6 - centerLon) * pxPerDeg - blockWidth6/2;
                
                const div6 = document.createElement('div');
                div6.className = 'zone-block';
                div6.style.width = blockWidth6 + 'px';
                div6.style.left = leftPos6 + 'px';
                div6.style.background = '#f0f7ff';
                if(centerLon >= startLon6 && centerLon < endLon6) div6.classList.add('active');
                
                div6.innerHTML = `<div style="font-size:14px; font-weight:bold; color:#2c3e50;">${zoneNum6}</div><span style="font-size:10px;">6åº¦å¸¦</span>`;
                div6.onclick = () => { document.getElementById('input-lon').value = cmLon6; jumpToZone(); };
                track6.appendChild(div6);
            }
        }
        
        // 3åº¦å¸¦
        for(let i = -6; i <= 6; i++) {
            const zoneNum3 = Math.floor((centerLon - 1.5) / 3) + 1 + i;
            if(zoneNum3 < 1 || zoneNum3 > 60) continue;
            const startLon3 = 1.5 + (zoneNum3 - 1) * 3;
            const endLon3 = startLon3 + 3;
            const cmLon3 = 3 * zoneNum3;
            
            if (cmLon3 >= startLon && cmLon3 <= endLon) {
                const blockWidth3 = 3 * pxPerDeg;
                const leftPos3 = centerPx + (cmLon3 - centerLon) * pxPerDeg - blockWidth3/2;
                
                const div3 = document.createElement('div');
                div3.className = 'zone-block';
                div3.style.width = blockWidth3 + 'px';
                div3.style.left = leftPos3 + 'px';
                div3.style.background = '#f0fff0';
                if(centerLon >= startLon3 && centerLon < endLon3) div3.classList.add('active');
                
                div3.innerHTML = `<div style="font-size:14px; font-weight:bold; color:#27ae60;">${zoneNum3}</div><span style="font-size:10px;">3åº¦å¸¦</span>`;
                div3.onclick = () => { document.getElementById('input-lon').value = cmLon3; jumpToZone(); };
                track3.appendChild(div3);
            }
        }
    }

    // ================= åŠŸèƒ½3ï¼šåæ ‡å¹³ç§» =================
    const rawA = 152863;
    const rawB = -148474;
    const shift = 500000;
    const zone = 17;

    function setStep(step) {
        const axis = document.getElementById('anim-axis-x');
        const ptA = document.getElementById('pt-a');
        const ptB = document.getElementById('pt-b');
        const lblA = document.getElementById('lbl-a');
        const lblB = document.getElementById('lbl-b');

        document.getElementById('td-shift-a').innerText = "-";
        document.getElementById('td-shift-b').innerText = "-";
        document.getElementById('td-gen-a').innerText = "-";
        document.getElementById('td-gen-b').innerText = "-";

        if(step === -1 || step === 0) {
            axis.style.left = "50%";
            ptA.style.left = "65.2%";
            ptB.style.left = "35.2%";
            lblA.innerText = "A";
            lblB.innerText = "B";
        }

        if(step >= 1) {
            const sa = rawA + shift;
            const sb = rawB + shift;
            document.getElementById('td-shift-a').innerText = sa.toLocaleString();
            document.getElementById('td-shift-b').innerText = sb.toLocaleString();
            axis.style.left = "10%";
            lblA.innerText = sa.toLocaleString();
            lblB.innerText = sb.toLocaleString();
        }

        if(step >= 2) {
            const ga = zone + " " + (rawA+shift).toLocaleString();
            const gb = zone + " " + (rawB+shift).toLocaleString();
            document.getElementById('td-gen-a').innerText = ga;
            document.getElementById('td-gen-b').innerText = gb;
            lblA.innerText = ga;
            lblB.innerText = gb;
        }
    }
    
    initCanvas();
    setStep(0);

</script>
</body>
</html>