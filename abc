<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>《测量与地图学》地图学应用小组汇报无记名评分</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background-color: white;
            border-radius: 12px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.08);
            overflow: hidden;
        }
        
        header {
            background: linear-gradient(135deg, #2c3e50, #4a6491);
            color: white;
            padding: 25px 30px;
            text-align: center;
        }
        
        h1 {
            font-size: 28px;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }
        
        h1 i {
            font-size: 32px;
        }
        
        .subtitle {
            font-size: 16px;
            opacity: 0.9;
            margin-bottom: 5px;
        }
        
        .chapter-info {
            background-color: #e8f4fc;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            font-size: 15px;
            color: #2c3e50;
            border-left: 4px solid #3498db;
        }
        
        .content-area {
            display: flex;
            flex-wrap: wrap;
            padding: 25px;
            gap: 25px;
        }
        
        .scoring-section {
            flex: 1;
            min-width: 300px;
            background-color: #f9fbfd;
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.05);
        }
        
        .results-section {
            flex: 1;
            min-width: 300px;
            background-color: #f9fbfd;
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.05);
        }
        
        .section-title {
            color: #2c3e50;
            font-size: 20px;
            margin-bottom: 20px;
            padding-bottom: 12px;
            border-bottom: 2px solid #3498db;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .section-title i {
            color: #3498db;
        }
        
        .form-group {
            margin-bottom: 25px;
        }
        
        label {
            display: block;
            font-weight: 600;
            margin-bottom: 8px;
            color: #2c3e50;
        }
        
        select, input {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #d1d9e6;
            border-radius: 6px;
            font-size: 15px;
            transition: border-color 0.3s;
        }
        
        select:focus, input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2);
        }
        
        .criteria-item {
            background-color: white;
            border-radius: 8px;
            padding: 18px;
            margin-bottom: 18px;
            border-left: 4px solid #3498db;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.03);
        }
        
        .criteria-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .criteria-name {
            font-weight: 600;
            color: #2c3e50;
        }
        
        .max-score {
            color: #7f8c8d;
            font-size: 14px;
        }
        
        .score-input {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .score-input input {
            width: 80px;
            text-align: center;
        }
        
        .score-slider {
            flex: 1;
            height: 6px;
            -webkit-appearance: none;
            background: #dfe6e9;
            border-radius: 3px;
            outline: none;
        }
        
        .score-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: #3498db;
            cursor: pointer;
            border: 2px solid white;
            box-shadow: 0 1px 3px rgba(0,0,0,0.2);
        }
        
        .total-score {
            background-color: #2c3e50;
            color: white;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            margin-top: 25px;
        }
        
        .total-score-value {
            font-size: 36px;
            font-weight: 700;
            margin: 10px 0;
            color: #3498db;
        }
        
        .submit-btn {
            background: linear-gradient(to right, #3498db, #2980b9);
            color: white;
            border: none;
            padding: 15px 25px;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            transition: all 0.3s ease;
            margin-top: 20px;
        }
        
        .submit-btn:hover {
            background: linear-gradient(to right, #2980b9, #1f639e);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.3);
        }
        
        .results-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }
        
        .results-table th {
            background-color: #2c3e50;
            color: white;
            padding: 12px 15px;
            text-align: left;
            font-weight: 600;
        }
        
        .results-table td {
            padding: 12px 15px;
            border-bottom: 1px solid #e0e0e0;
        }
        
        .results-table tr:nth-child(even) {
            background-color: #f8f9fa;
        }
        
        .results-table tr:hover {
            background-color: #e8f4fc;
        }
        
        .final-score {
            font-weight: 700;
            color: #2c3e50;
        }
        
        .average-display {
            background-color: #2c3e50;
            color: white;
            padding: 25px;
            border-radius: 8px;
            margin-top: 25px;
            text-align: center;
        }
        
        .average-value {
            font-size: 42px;
            font-weight: 700;
            margin: 15px 0;
            color: #2ecc71;
        }
        
        .instructions {
            background-color: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-top: 30px;
            border-left: 4px solid #f39c12;
        }
        
        .instructions h3 {
            color: #2c3e50;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .instructions ul {
            padding-left: 20px;
        }
        
        .instructions li {
            margin-bottom: 8px;
        }
        
        .group-input-area {
            display: flex;
            gap: 15px;
            margin-bottom: 25px;
            align-items: center;
        }
        
        .group-input {
            flex: 1;
        }
        
        .group-select-btn {
            padding: 12px 25px;
            background-color: #3498db;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s;
        }
        
        .group-select-btn:hover {
            background-color: #2980b9;
        }
        
        .vote-stats {
            background-color: #e8f4fc;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            text-align: center;
            border-left: 4px solid #3498db;
        }
        
        .vote-stats h3 {
            color: #2c3e50;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .vote-count {
            font-size: 36px;
            font-weight: 700;
            color: #3498db;
            margin: 10px 0;
        }
        
        @media (max-width: 768px) {
            .content-area {
                flex-direction: column;
                padding: 15px;
            }
            
            h1 {
                font-size: 24px;
            }
            
            .group-input-area {
                flex-direction: column;
                align-items: stretch;
            }
        }
        
        footer {
            text-align: center;
            margin-top: 30px;
            padding: 20px;
            color: #7f8c8d;
            font-size: 14px;
            border-top: 1px solid #eee;
        }
        
        .anonymous-notice {
            background-color: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            color: #856404;
        }
        
        .current-group-display {
            background-color: #3498db;
            color: white;
            padding: 10px 20px;
            border-radius: 6px;
            display: inline-block;
            font-weight: 600;
            margin-bottom: 20px;
        }
        
        .refresh-btn {
            background: linear-gradient(to right, #f39c12, #e67e22);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            margin-top: 10px;
            transition: all 0.3s ease;
        }
        
        .refresh-btn:hover {
            background: linear-gradient(to right, #e67e22, #d35400);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(243, 156, 18, 0.3);
        }
        
        .export-btn {
            background: linear-gradient(to right, #2ecc71, #27ae60);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            margin-top: 10px;
            transition: all 0.3s ease;
            width: 100%;
        }
        
        .export-btn:hover {
            background: linear-gradient(to right, #27ae60, #219653);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(46, 204, 113, 0.3);
        }
        
        .import-btn {
            background: linear-gradient(to right, #9b59b6, #8e44ad);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            margin-top: 10px;
            transition: all 0.3s ease;
            width: 100%;
        }
        
        .import-btn:hover {
            background: linear-gradient(to right, #8e44ad, #7d3c98);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(155, 89, 182, 0.3);
        }
        
        .file-input {
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-map-marked-alt"></i> 《测量与地图学》地图学应用小组汇报评分</h1>
            <p class="subtitle">第十六章第五节：地图学应用 - 无记名小组汇报评分系统</p>
            <div class="chapter-info">
                <p><i class="fas fa-info-circle"></i> 请根据评分标准为各小组的课堂展示进行无记名评分。系统将自动统计投票人数并计算平均分作为最终成绩。</p>
            </div>
        </header>
        
        <div class="content-area">
            <div class="scoring-section">
                <h2 class="section-title"><i class="fas fa-edit"></i> 评分区域</h2>
                
                <div class="anonymous-notice">
                    <i class="fas fa-user-secret"></i> 本评分系统采用无记名投票方式，不记录评分人信息，仅统计投票总数。
                </div>
                
                <div class="group-input-area">
                    <div class="group-input">
                        <label for="groupNumber"><i class="fas fa-users"></i> 请输入汇报小组号</label>
                        <input type="text" id="groupNumber" placeholder="例如：第1组、A组、地图应用组等">
                    </div>
                    <button class="group-select-btn" id="selectGroup">选择小组</button>
                </div>
                
                <div class="current-group-display" id="currentGroupDisplay">
                    当前未选择小组
                </div>
                
                <div class="criteria-item">
                    <div class="criteria-header">
                        <span class="criteria-name">基本素质 (20分)</span>
                        <span class="max-score">满分: 20分</span>
                    </div>
                    <p style="font-size: 14px; color: #555; margin-bottom: 12px;">仪表整洁、教态大方、亲切、有感染力，精神饱满、能较好的运用动作、手势表达对讲稿的理解。普通话标准，语言准确、生动、精炼、流畅；板书规范，设计合理；熟练恰当使用现代教育技术手段。</p>
                    <div class="score-input">
                        <input type="number" id="basicScore" min="0" max="20" value="0" class="score-number">
                        <input type="range" min="0" max="20" value="0" class="score-slider" data-target="basicScore">
                    </div>
                </div>
                
                <div class="criteria-item">
                    <div class="criteria-header">
                        <span class="criteria-name">演讲内容 (30分)</span>
                        <span class="max-score">满分: 30分</span>
                    </div>
                    <p style="font-size: 14px; color: #555; margin-bottom: 12px;">深入研读教材等参考资料，展示内容选取合理；体现教学内容的整体性和关联性；展示内容丰富、完整，具有前沿性和创新性，具有典型理论与案例相结合的分析。</p>
                    <div class="score-input">
                        <input type="number" id="contentScore" min="0" max="30" value="0" class="score-number">
                        <input type="range" min="0" max="30" value="0" class="score-slider" data-target="contentScore">
                    </div>
                </div>
                
                <div class="criteria-item">
                    <div class="criteria-header">
                        <span class="criteria-name">展示过程 (30分)</span>
                        <span class="max-score">满分: 30分</span>
                    </div>
                    <p style="font-size: 14px; color: #555; margin-bottom: 12px;">小组分工明确，组员全程参与，展示过程结构严谨，层次清晰，过渡合理，自然流畅，时间把握较好。具有较好的应变及驾驭教材等参考资料和课堂的能力；以学生为主体，学生参与度高，课堂民主和谐，善于营造轻松愉快的课堂氛围。</p>
                    <div class="score-input">
                        <input type="number" id="processScore" min="0" max="30" value="0" class="score-number">
                        <input type="range" min="0" max="30" value="0" class="score-slider" data-target="processScore">
                    </div>
                </div>
                
                <div class="criteria-item">
                    <div class="criteria-header">
                        <span class="criteria-name">课件制作 (20分)</span>
                        <span class="max-score">满分: 20分</span>
                    </div>
                    <p style="font-size: 14px; color: #555; margin-bottom: 12px;">内容完整清晰，有代表性、真实有效、新颖，能准确地表达内容，重点突出。课件的设计新颖，具有较强的创新性，有趣味性；讲稿完整，语句通顺，格式规范。合理使用了文本、图片、表格、图表、图形、动画、动作等表现工具。</p>
                    <div class="score-input">
                        <input type="number" id="presentationScore" min="0" max="20" value="0" class="score-number">
                        <input type="range" min="0" max="20" value="0" class="score-slider" data-target="presentationScore">
                    </div>
                </div>
                
                <div class="total-score">
                    <div>当前评分总分</div>
                    <div class="total-score-value" id="currentTotal">0</div>
                    <div>满分：100分</div>
                </div>
                
                <button class="submit-btn" id="submitScore">
                    <i class="fas fa-paper-plane"></i> 提交评分
                </button>
            </div>
            
            <div class="results-section">
                <h2 class="section-title"><i class="fas fa-chart-bar"></i> 评分结果</h2>
                
                <div class="vote-stats">
                    <h3><i class="fas fa-vote-yea"></i> 投票统计</h3>
                    <div>当前小组：<strong id="displayGroupName">未选择</strong></div>
                    <div class="vote-count" id="voteCount">0</div>
                    <div>位同学已投票</div>
                    <button class="refresh-btn" id="refreshResults">
                        <i class="fas fa-sync-alt"></i> 刷新结果
                    </button>
                </div>
                
                <div style="overflow-x: auto;">
                    <table class="results-table">
                        <thead>
                            <tr>
                                <th>评分编号</th>
                                <th>基本素质</th>
                                <th>演讲内容</th>
                                <th>展示过程</th>
                                <th>课件制作</th>
                                <th>总分</th>
                            </tr>
                        </thead>
                        <tbody id="scoresTable">
                            <!-- 评分记录将在这里动态生成 -->
                            <tr><td colspan="6" style="text-align: center; padding: 30px;">暂无评分记录</td></tr>
                        </tbody>
                    </table>
                </div>
                
                <div class="average-display">
                    <div>小组最终平均分</div>
                    <div class="average-value" id="groupAverage">0.0</div>
                    <div>基于 <span id="totalVotes">0</span> 位同学的评分</div>
                </div>
                
                <div class="instructions" style="margin-top: 20px;">
                    <h3><i class="fas fa-database"></i> 数据管理</h3>
                    <p>数据保存在浏览器本地，可使用以下功能管理评分数据：</p>
                    <button class="export-btn" id="exportData">
                        <i class="fas fa-file-export"></i> 导出评分数据
                    </button>
                    <button class="import-btn" id="importData">
                        <i class="fas fa-file-import"></i> 导入评分数据
                    </button>
                    <input type="file" id="importFile" accept=".json" class="file-input">
                </div>
            </div>
        </div>
        
        <div class="instructions">
            <h3><i class="fas fa-clipboard-check"></i> 使用说明</h3>
            <ul>
                <li>本评分系统采用<strong>无记名投票</strong>方式，不记录评分人信息，仅统计投票总数。</li>
                <li>请先输入汇报小组号，然后根据评分标准进行评分。</li>
                <li>每个评分项目有相应的分值上限，请确保评分不超过上限。</li>
                <li>每位同学可以为每个小组评分一次，系统将计算所有评分的平均值作为该小组的最终得分。</li>
                <li>评分提交后无法修改，请确认后再提交。</li>
                <li>最终成绩将以全班同学给出的平均分为准。</li>
                <li>评分数据保存在浏览器本地存储中，如需多设备共享，请使用"导出/导入数据"功能。</li>
            </ul>
        </div>
        
        <footer>
            <p>《测量与地图学》地图学应用小组汇报无记名评分系统 &copy; 2023 | 第十六章第五节：地图学应用</p>
            <p>数据存储：评分数据保存在浏览器本地，清空浏览器缓存将丢失数据</p>
        </footer>
    </div>

    <script>
        // 当前选中的小组
        let currentGroup = "";
        
        // 存储所有小组的评分数据
        let allScores = {};
        
        // 从本地存储加载数据
        function loadScores() {
            const savedScores = localStorage.getItem('cartographyAnonymousScores');
            if (savedScores) {
                allScores = JSON.parse(savedScores);
                updateResultsDisplay();
            }
        }
        
        // 保存数据到本地存储
        function saveScores() {
            localStorage.setItem('cartographyAnonymousScores', JSON.stringify(allScores));
        }
        
        // 初始化页面
        document.addEventListener('DOMContentLoaded', function() {
            loadScores();
            
            // 选择小组按钮事件
            document.getElementById('selectGroup').addEventListener('click', function() {
                const groupInput = document.getElementById('groupNumber').value.trim();
                
                if (!groupInput) {
                    alert('请输入小组号');
                    return;
                }
                
                currentGroup = groupInput;
                document.getElementById('currentGroupDisplay').textContent = `当前评分小组：${currentGroup}`;
                document.getElementById('displayGroupName').textContent = currentGroup;
                
                // 初始化该小组的数据（如果不存在）
                if (!allScores[currentGroup]) {
                    allScores[currentGroup] = [];
                }
                
                // 更新结果显示
                updateResultsDisplay();
                
                // 重置评分表单
                resetScoringForm();
            });
            
            // 分数输入框与滑块的同步
            document.querySelectorAll('.score-number').forEach(input => {
                input.addEventListener('input', function() {
                    const targetId = this.id;
                    const slider = document.querySelector(`.score-slider[data-target="${targetId}"]`);
                    slider.value = this.value;
                    updateTotalScore();
                });
            });
            
            document.querySelectorAll('.score-slider').forEach(slider => {
                slider.addEventListener('input', function() {
                    const targetId = this.dataset.target;
                    const numberInput = document.getElementById(targetId);
                    numberInput.value = this.value;
                    updateTotalScore();
                });
            });
            
            // 提交评分
            document.getElementById('submitScore').addEventListener('click', submitScore);
            
            // 刷新结果按钮
            document.getElementById('refreshResults').addEventListener('click', function() {
                loadScores();
                alert('评分结果已刷新');
            });
            
            // 导出数据按钮
            document.getElementById('exportData').addEventListener('click', exportData);
            
            // 导入数据按钮
            document.getElementById('importData').addEventListener('click', function() {
                document.getElementById('importFile').click();
            });
            
            document.getElementById('importFile').addEventListener('change', importData);
            
            // 初始更新总分
            updateTotalScore();
        });
        
        // 更新总分显示
        function updateTotalScore() {
            const basicScore = parseInt(document.getElementById('basicScore').value) || 0;
            const contentScore = parseInt(document.getElementById('contentScore').value) || 0;
            const processScore = parseInt(document.getElementById('processScore').value) || 0;
            const presentationScore = parseInt(document.getElementById('presentationScore').value) || 0;
            
            const total = basicScore + contentScore + processScore + presentationScore;
            document.getElementById('currentTotal').textContent = total;
        }
        
        // 提交评分
        function submitScore() {
            // 检查是否已选择小组
            if (!currentGroup) {
                alert('请先选择要评分的小组');
                return;
            }
            
            const basicScore = parseInt(document.getElementById('basicScore').value);
            const contentScore = parseInt(document.getElementById('contentScore').value);
            const processScore = parseInt(document.getElementById('processScore').value);
            const presentationScore = parseInt(document.getElementById('presentationScore').value);
            
            // 验证输入
            if (isNaN(basicScore) || basicScore < 0 || basicScore > 20) {
                alert('请为"基本素质"项输入0-20之间的有效分数');
                return;
            }
            
            if (isNaN(contentScore) || contentScore < 0 || contentScore > 30) {
                alert('请为"演讲内容"项输入0-30之间的有效分数');
                return;
            }
            
            if (isNaN(processScore) || processScore < 0 || processScore > 30) {
                alert('请为"展示过程"项输入0-30之间的有效分数');
                return;
            }
            
            if (isNaN(presentationScore) || presentationScore < 0 || presentationScore > 20) {
                alert('请为"课件制作"项输入0-20之间的有效分数');
                return;
            }
            
            // 生成匿名评分ID（基于时间戳和随机数）
            const scoreId = "评分" + (allScores[currentGroup].length + 1);
            
            // 创建评分对象
            const scoreEntry = {
                id: scoreId,
                basic: basicScore,
                content: contentScore,
                process: processScore,
                presentation: presentationScore,
                total: basicScore + contentScore + processScore + presentationScore,
                timestamp: new Date().toLocaleString()
            };
            
            // 添加到当前小组的评分数组
            allScores[currentGroup].push(scoreEntry);
            
            // 保存到本地存储
            saveScores();
            
            // 更新结果显示
            updateResultsDisplay();
            
            // 重置表单
            resetScoringForm();
            
            alert(`无记名评分已提交！${currentGroup}当前平均分：${calculateGroupAverage(currentGroup).toFixed(1)}`);
        }
        
        // 重置评分表单
        function resetScoringForm() {
            document.getElementById('basicScore').value = 0;
            document.getElementById('contentScore').value = 0;
            document.getElementById('processScore').value = 0;
            document.getElementById('presentationScore').value = 0;
            
            // 同步滑块
            document.querySelectorAll('.score-slider').forEach(slider => {
                const targetId = slider.dataset.target;
                document.getElementById(targetId).value = 0;
                slider.value = 0;
            });
            
            updateTotalScore();
        }
        
        // 更新结果显示
        function updateResultsDisplay() {
            const scoresTable = document.getElementById('scoresTable');
            
            // 如果没有选择小组或该小组没有评分记录
            if (!currentGroup || !allScores[currentGroup] || allScores[currentGroup].length === 0) {
                scoresTable.innerHTML = '<tr><td colspan="6" style="text-align: center; padding: 30px;">暂无评分记录</td></tr>';
                document.getElementById('groupAverage').textContent = '0.0';
                document.getElementById('totalVotes').textContent = '0';
                document.getElementById('voteCount').textContent = '0';
                return;
            }
            
            const groupScores = allScores[currentGroup];
            
            // 清空表格内容
            scoresTable.innerHTML = '';
            
            // 添加评分记录
            groupScores.forEach((score, index) => {
                const row = document.createElement('tr');
                
                row.innerHTML = `
                    <td>${score.id}</td>
                    <td>${score.basic}</td>
                    <td>${score.content}</td>
                    <td>${score.process}</td>
                    <td>${score.presentation}</td>
                    <td class="final-score">${score.total}</td>
                `;
                
                scoresTable.appendChild(row);
            });
            
            // 计算并显示平均分
            const average = calculateGroupAverage(currentGroup);
            document.getElementById('groupAverage').textContent = average.toFixed(1);
            document.getElementById('totalVotes').textContent = groupScores.length;
            document.getElementById('voteCount').textContent = groupScores.length;
        }
        
        // 计算小组平均分
        function calculateGroupAverage(groupName) {
            if (!allScores[groupName] || allScores[groupName].length === 0) {
                return 0;
            }
            
            const groupScores = allScores[groupName];
            const total = groupScores.reduce((sum, score) => sum + score.total, 0);
            return total / groupScores.length;
        }
        
        // 导出数据
        function exportData() {
            const dataStr = JSON.stringify(allScores, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            const exportFileDefaultName = '测量与地图学评分数据.json';
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
            
            alert('评分数据已导出为JSON文件，可用于备份或导入到其他设备');
        }
        
        // 导入数据
        function importData(event) {
            const file = event.target.files[0];
            if (!file) {
                return;
            }
            
            if (!confirm('导入数据将覆盖当前所有评分记录，确定要继续吗？')) {
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const importedData = JSON.parse(e.target.result);
                    allScores = importedData;
                    saveScores();
                    updateResultsDisplay();
                    alert('评分数据导入成功！');
                } catch (error) {
                    alert('导入失败：文件格式不正确');
                    console.error(error);
                }
            };
            reader.readAsText(file);
            
            // 清除文件输入，以便可以再次选择同一文件
            event.target.value = '';
        }
        
        // 页面加载时检查URL参数中的小组信息
        function checkUrlParams() {
            const urlParams = new URLSearchParams(window.location.search);
            const groupParam = urlParams.get('group');
            
            if (groupParam) {
                currentGroup = decodeURIComponent(groupParam);
                document.getElementById('groupNumber').value = currentGroup;
                document.getElementById('currentGroupDisplay').textContent = `当前评分小组：${currentGroup}`;
                document.getElementById('displayGroupName').textContent = currentGroup;
                
                // 初始化该小组的数据（如果不存在）
                if (!allScores[currentGroup]) {
                    allScores[currentGroup] = [];
                }
                
                // 更新结果显示
                updateResultsDisplay();
            }
        }
        
        // 页面加载时检查URL参数
        setTimeout(checkUrlParams, 100);
        
        // 示例数据初始化（第一次使用时）
        function initializeSampleData() {
            // 检查是否已经有数据
            if (localStorage.getItem('cartographyAnonymousScores')) {
                return;
            }
            
            // 添加一些示例小组和评分
            const sampleGroups = ['第1组', '第2组', '地图应用组', 'GIS分析组'];
            
            sampleGroups.forEach(group => {
                allScores[group] = [];
                const sampleCount = Math.floor(Math.random() * 4) + 3; // 3-6个示例评分
                
                for (let i = 0; i < sampleCount; i++) {
                    const basic = Math.floor(Math.random() * 6) + 15; // 15-20
                    const content = Math.floor(Math.random() * 11) + 20; // 20-30
                    const process = Math.floor(Math.random() * 11) + 20; // 20-30
                    const presentation = Math.floor(Math.random() * 6) + 15; // 15-20
                    const total = basic + content + process + presentation;
                    
                    allScores[group].push({
                        id: `评分${i+1}`,
                        basic: basic,
                        content: content,
                        process: process,
                        presentation: presentation,
                        total: total,
                        timestamp: new Date().toLocaleString()
                    });
                }
            });
            
            saveScores();
        }
        
        // 页面加载后初始化示例数据（仅第一次使用）
        setTimeout(initializeSampleData, 500);
    </script>
</body>
</html>
